<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ NFT - Martian Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(to right, #1a1a2e, #16213e);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .back-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 600px;
        }

        .sidebar {
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 30px;
            overflow-y: auto;
        }

        .main-content {
            padding: 30px;
            background: white;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f1f5f9;
            border-radius: 10px;
        }

        .option-item {
            background: white;
            border: 2px solid #cbd5e1;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .option-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .option-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .filters {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            background: #f1f5f9;
            border-radius: 8px;
            user-select: none;
        }

        .filter-checkbox input {
            display: none;
        }

        .filter-checkbox .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-checkbox input:checked + .checkmark {
            background: #667eea;
            border-color: #667eea;
        }

        .filter-checkbox input:checked + .checkmark::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
        }

        .execute-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .execute-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .execute-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-container {
            min-height: 400px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: #64748b;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .nft-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .nft-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .nft-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f8fafc;
        }

        .nft-info {
            padding: 15px;
        }

        .nft-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nft-stats {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .stat-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .synergy-badge {
            background: #e0f2fe;
            color: #0369a1;
        }

        .rarity-badge {
            background: #fef3c7;
            color: #92400e;
        }

        .skin-badge {
            background: #dcfce7;
            color: #166534;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px;
        }

        .page-btn {
            padding: 8px 16px;
            background: #f1f5f9;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .page-btn:hover {
            background: #e2e8f0;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .options-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ NFT –ø–æ —Å–∏–Ω–µ—Ä–≥–∏—è–º</h1>
            <a href="/" class="back-btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </header>
        
        <div class="content">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ -->
            <div class="sidebar">
                <div class="section">
                    <h3 class="section-title">üéØ –£—Ä–æ–≤–µ–Ω—å —Å–∏–Ω–µ—Ä–≥–∏–∏</h3>
                    <div class="options-grid" id="synergyOptions">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                    </div>
                </div>
                
                <div class="section">
                    <h3 class="section-title">üé® Skin Tone</h3>
                    <div class="options-grid" id="skinToneOptions">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                    </div>
                </div>
                
                <div class="section">
                    <h3 class="section-title">‚≠ê –†–µ–¥–∫–æ—Å—Ç—å –∞—Ç—Ä–∏–±—É—Ç–æ–≤</h3>
                    <div class="options-grid" id="rarityOptions">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                    </div>
                </div>
                
                <div class="filters">
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filterAll" checked>
                        <span class="checkmark"></span>
                        <span>–í—Å–µ NFT</span>
                    </label>
                    
                    <label class="filter-checkbox">
                        <input type="checkbox" id="filterOnSale">
                        <span class="checkmark"></span>
                        <span>–ù–∞ –ø—Ä–æ–¥–∞–∂–µ</span>
                    </label>
                </div>
                
                <button class="execute-btn" id="executeBtn" onclick="executeSort()">
                    üöÄ –ù–∞—á–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; font-size: 0.9rem; color: #0369a1;">
                    üí° <strong>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –ò—â–µ—Ç NFT –≥–¥–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–∏–Ω–µ—Ä–≥–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑.
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ -->
            <div class="main-content">
                <h2 style="margin-bottom: 20px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                
                <div class="results-container">
                    <div id="resultsArea">
                        <div class="loading" id="initialLoading">
                            <div class="spinner"></div>
                            <span>–ó–∞–≥—Ä—É–∂–∞—é –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...</span>
                        </div>
                        
                        <div id="resultsContent" style="display: none;">
                            <div id="resultsStats" style="margin-bottom: 20px;"></div>
                            <div id="resultsGrid" class="results-grid"></div>
                            <div id="pagination" class="pagination"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let sortData = null;
        let currentResults = null;
        let currentPage = 1;
        const pageSize = 12;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            await loadSortData();
            setupFilterLogic();
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        async function loadSortData() {
            try {
                const response = await fetch('/api/sort/data');
                const data = await response.json();
                
                if (data.success) {
                    sortData = data.data;
                    renderInterface();
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                document.getElementById('initialLoading').innerHTML = 
                    `<span style="color: #dc2626;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        function renderInterface() {
            // –†–µ–Ω–¥–µ—Ä–∏–º –æ–ø—Ü–∏–∏ —Å–∏–Ω–µ—Ä–≥–∏–∏
            const synergyContainer = document.getElementById('synergyOptions');
            synergyContainer.innerHTML = sortData.synergyOptions.map(level => `
                <div class="option-item ${level === 2 ? 'selected' : ''}" 
                     data-value="${level}"
                     onclick="selectSynergy(this, ${level})">
                    ${level}+ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                </div>
            `).join('');
            
            // –†–µ–Ω–¥–µ—Ä–∏–º Skin Tone
            const skinToneContainer = document.getElementById('skinToneOptions');
            skinToneContainer.innerHTML = sortData.skinTones.map(tone => `
                <div class="option-item" 
                     data-value="${tone.name}"
                     onclick="toggleOption(this, 'skinTone')">
                    ${tone.name}
                </div>
            `).join('');
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Ä–µ–¥–∫–æ—Å—Ç–∏
            const rarityContainer = document.getElementById('rarityOptions');
            rarityContainer.innerHTML = sortData.rarities.map(rarity => `
                <div class="option-item" 
                     data-value="${rarity.name}"
                     onclick="toggleOption(this, 'rarity')">
                    ${rarity.name}
                </div>
            `).join('');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('initialLoading').style.display = 'none';
        }
        
        // –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–∏–Ω–µ—Ä–≥–∏–∏
        function selectSynergy(element, level) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö
            document.querySelectorAll('#synergyOptions .option-item').forEach(el => {
                el.classList.remove('selected');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
            element.classList.add('selected');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            if (sortData) {
                sortData.selectedSynergyLevel = level;
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–ø—Ü–∏–∏ (Skin Tone / Rarity)
        function toggleOption(element, type) {
            element.classList.toggle('selected');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π
            updateSelectedCount(type);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π
        function updateSelectedCount(type) {
            const containerId = type === 'skinTone' ? 'skinToneOptions' : 'rarityOptions';
            const selectedCount = document.querySelectorAll(`#${containerId} .option-item.selected`).length;
            const titleElement = document.querySelector(`#${containerId}`).previousElementSibling;
            
            if (selectedCount > 0) {
                titleElement.textContent = titleElement.textContent.replace(/\(\d+\)/, '') + ` (${selectedCount})`;
            } else {
                titleElement.textContent = titleElement.textContent.replace(/ \(\d+\)/, '');
            }
        }
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ)
        function setupFilterLogic() {
            const filterAll = document.getElementById('filterAll');
            const filterOnSale = document.getElementById('filterOnSale');
            
            filterAll.addEventListener('change', () => {
                if (filterAll.checked) {
                    filterOnSale.checked = false;
                }
            });
            
            filterOnSale.addEventListener('change', () => {
                if (filterOnSale.checked) {
                    filterAll.checked = false;
                }
            });
        }
        
        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        async function executeSort() {
            const executeBtn = document.getElementById('executeBtn');
            const resultsArea = document.getElementById('resultsArea');
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                executeBtn.disabled = true;
                executeBtn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; margin: 0 auto;"></div>';
                
                // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const synergyLevel = sortData.selectedSynergyLevel || 2;
                const selectedSkinTones = Array.from(
                    document.querySelectorAll('#skinToneOptions .option-item.selected')
                ).map(el => el.dataset.value);
                
                const selectedRarities = Array.from(
                    document.querySelectorAll('#rarityOptions .option-item.selected')
                ).map(el => el.dataset.value);
                
                const filterOptions = {
                    allNfts: document.getElementById('filterAll').checked,
                    onSaleOnly: document.getElementById('filterOnSale').checked
                };
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                resultsArea.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>
                            <div>üîç –í—ã–ø–æ–ª–Ω—è—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É...</div>
                            <div style="font-size: 0.9rem; margin-top: 10px; color: #64748b;">
                                –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:<br>
                                ‚Ä¢ –°–∏–Ω–µ—Ä–≥–∏—è: ${synergyLevel}+ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π<br>
                                ‚Ä¢ Skin Tone: ${selectedSkinTones.length > 0 ? selectedSkinTones.length + ' –≤—ã–±—Ä–∞–Ω–æ' : '–í—Å–µ'}<br>
                                ‚Ä¢ –†–µ–¥–∫–æ—Å—Ç–∏: ${selectedRarities.length > 0 ? selectedRarities.length + ' –≤—ã–±—Ä–∞–Ω–æ' : '–í—Å–µ'}
                            </div>
                        </div>
                    </div>
                `;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('/api/sort/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        synergyLevel,
                        selectedSkinTones,
                        selectedRarities,
                        filterOptions,
                        userId: 'web_user',
                        username: 'web_user'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentResults = data.results;
                    renderResults(data);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:', error);
                resultsArea.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #dc2626;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                        <h3 style="margin-bottom: 10px;">–û—à–∏–±–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</h3>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" 
                                style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                executeBtn.disabled = false;
                executeBtn.innerHTML = 'üöÄ –ù–∞—á–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É';
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        function renderResults(data) {
            const resultsContent = document.getElementById('resultsContent');
            const resultsStats = document.getElementById('resultsStats');
            const resultsGrid = document.getElementById('resultsGrid');
            const pagination = document.getElementById('pagination');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            document.getElementById('initialLoading').style.display = 'none';
            resultsContent.style.display = 'block';
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = data.stats;
            resultsStats.innerHTML = `
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
                        <div style="font-size: 0.9rem; color: #0369a1; margin-bottom: 5px;">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #0369a1;">${data.totalResults}</div>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
                        <div style="font-size: 0.9rem; color: #92400e; margin-bottom: 5px;">–°–∏–Ω–µ—Ä–≥–∏—è 2</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #92400e;">${stats.synergyDistribution.level2}</div>
                    </div>
                    
                    <div style="background: #dcfce7; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px;">
                        <div style="font-size: 0.9rem; color: #166534; margin-bottom: 5px;">–°–∏–Ω–µ—Ä–≥–∏—è 3+</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #166534;">${stats.synergyDistribution.level3 + stats.synergyDistribution.level4plus}</div>
                    </div>
                </div>
            `;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            renderPage(1);
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
            renderPagination();
            
            function renderPage(page) {
                currentPage = page;
                const startIndex = (page - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const pageResults = data.results.results.slice(startIndex, endIndex);
                
                resultsGrid.innerHTML = pageResults.map(nft => `
                    <div class="nft-card">
                        ${nft.imageUrl ? `
                            <img src="${nft.imageUrl}" alt="${nft.name}" class="nft-image" 
                                 onerror="this.src='https://via.placeholder.com/300x200?text=NFT+Image'">
                        ` : `
                            <div class="nft-image" style="display: flex; align-items: center; justify-content: center; color: #94a3b8;">
                                üñºÔ∏è –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            </div>
                        `}
                        <div class="nft-info">
                            <div class="nft-name" title="${nft.name}">${nft.name}</div>
                            <div class="nft-stats">
                                <span class="stat-badge synergy-badge">üéØ ${nft.synergyScore}</span>
                                <span class="stat-badge rarity-badge">‚≠ê ${nft.rarity || '–ù–µ–∏–∑–≤.'}</span>
                                <span class="stat-badge skin-badge">üé® ${nft.skinTone}</span>
                            </div>
                            ${nft.matchingSynergies && nft.matchingSynergies.length > 0 ? `
                                <div style="font-size: 0.9rem; color: #475569; margin-top: 10px;">
                                    –°–∏–Ω–µ—Ä–≥–∏—è: <strong>${nft.matchingSynergies[0].synergyName}</strong>
                                </div>
                            ` : ''}
                            <button onclick="viewNftDetails(${nft.nftIndex})" 
                                    style="margin-top: 15px; padding: 8px 16px; width: 100%; 
                                           background: #f1f5f9; border: 1px solid #cbd5e1; 
                                           border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            function renderPagination() {
                const totalPages = Math.ceil(data.results.results.length / pageSize);
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }
                
                let paginationHTML = '';
                
                // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
                if (currentPage > 1) {
                    paginationHTML += `<button class="page-btn" onclick="renderPage(${currentPage - 1})">‚Üê –ù–∞–∑–∞–¥</button>`;
                }
                
                // –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                        paginationHTML += `
                            <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                    onclick="renderPage(${i})">
                                ${i}
                            </button>
                        `;
                    } else if (i === currentPage - 3 || i === currentPage + 3) {
                        paginationHTML += `<span style="padding: 8px;">...</span>`;
                    }
                }
                
                // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
                if (currentPage < totalPages) {
                    paginationHTML += `<button class="page-btn" onclick="renderPage(${currentPage + 1})">–í–ø–µ—Ä–µ–¥ ‚Üí</button>`;
                }
                
                pagination.innerHTML = paginationHTML;
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick
            window.renderPage = renderPage;
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π NFT
        async function viewNftDetails(index) {
            try {
                const response = await fetch(`/api/sort/nft/${index}`);
                const data = await response.json();
                
                if (data.success) {
                    showNftModal(data.nft);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π NFT:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ NFT');
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ NFT
        function showNftModal(nft) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                padding: 20px;
            `;
            
            const attributesHTML = nft.attributes.map(attr => `
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${attr.trait_type}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;"><strong>${attr.value || '–ù–µ—Ç'}</strong></td>
                    <td style="padding: 8px; border-bottom: 1px solid #e2e8f0;">${attr.rarity || '–ù–µ–∏–∑–≤.'}</td>
                </tr>
            `).join('');
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 800px;
                    width: 100%;
                    max-height: 90vh;
                    overflow-y: auto;
                    position: relative;
                ">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: 15px; right: 15px; 
                                   background: none; border: none; font-size: 1.5rem; 
                                   cursor: pointer; color: #64748b;">
                        √ó
                    </button>
                    
                    <h2 style="margin-bottom: 20px; padding-right: 30px;">${nft.formatted.name}</h2>
                    
                    <div style="display: grid; grid-template-columns: 300px 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            ${nft.formatted.imageUrl ? `
                                <img src="${nft.formatted.imageUrl}" 
                                     alt="${nft.formatted.name}" 
                                     style="width: 100%; border-radius: 10px;">
                            ` : `
                                <div style="width: 100%; height: 300px; background: #f8fafc; 
                                            border-radius: 10px; display: flex; align-items: center; 
                                            justify-content: center; color: #94a3b8;">
                                    üñºÔ∏è –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                </div>
                            `}
                        </div>
                        
                        <div>
                            <h3 style="margin-bottom: 15px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            <div style="background: #f8fafc; padding: 20px; border-radius: 10px;">
                                <p><strong>–ò–Ω–¥–µ–∫—Å:</strong> ${nft.index}</p>
                                <p><strong>–ê–¥—Ä–µ—Å:</strong> ${nft.formatted.userFriendlyAddress || truncateText(nft.address, 30)}</p>
                                <p><strong>–í–ª–∞–¥–µ–ª–µ—Ü:</strong> ${nft.formatted.owner}</p>
                                ${nft.on_sale ? `
                                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="color: #16a34a;">üí∞ –ù–∞ –ø—Ä–æ–¥–∞–∂–µ</span></p>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 15px;">–ê—Ç—Ä–∏–±—É—Ç—ã (${nft.attributes.length})</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f1f5f9;">
                                    <th style="padding: 12px; text-align: left;">–¢–∏–ø</th>
                                    <th style="padding: 12px; text-align: left;">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                    <th style="padding: 12px; text-align: left;">–†–µ–¥–∫–æ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${attributesHTML}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 15px;">
                        ${nft.formatted.getgemsLink ? `
                            <a href="${nft.formatted.getgemsLink}" target="_blank" 
                               style="padding: 10px 20px; background: #667eea; color: white; 
                                      text-decoration: none; border-radius: 6px;">
                                –ù–∞ GetGems
                            </a>
                        ` : ''}
                        
                        ${nft.formatted.ownerLink ? `
                            <a href="${nft.formatted.ownerLink}" target="_blank" 
                               style="padding: 10px 20px; background: #f1f5f9; color: #333; 
                                      text-decoration: none; border-radius: 6px; border: 1px solid #cbd5e1;">
                                –í–ª–∞–¥–µ–ª–µ—Ü
                            </a>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–µ–∑–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
    </script>
</body>
</html>